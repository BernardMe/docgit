

# 原理性概念

## 什么是跨域？

专业的解释是，两个不同源的服务去访问对方的资源，就是所谓的跨域，而浏览器处于安全方面的考虑是不允许跨域请求的

`内网的一台电脑要上因特网，就需要端口映射 `

### 什么是同源 

同源是指协议相同（http和https也属于不同协议）、域名相同、端口相同；如果中间有任何一个不相同，两个服务就属于不同源，这样一方去访问另外一方的资源时候就会产生跨域问题。

## 非同源策略的限制
（1）Cookie、LocalStorage和IndexDB无法获取。

（2）DOM无法获得。

（3）AJAX请求不能发送。

## 如果浏览器支持跨域会产生什么问题？
如果浏览器支持跨域请求的话，那么意味着两个站点跨域共享Cookie了，而Cookie

会记录一些用户访问信息，例如网站浏览记录和用户名密码，通常我们网站上不需要输入用户名密码直接登录，而这些信息都是通常记录在Cookie里面。

既然Cookie里面也许会有一些重要的信息，如果其他站点可以共享这些信息的话，那是件很危险的事情，当别人盗用了你网站的Cookie，然后再伪造一个请求（假如是支付）携带这个Cookie里的信息（有可能是账户密码）访问往网站，而服务器没有设置对应的安全策略，那么这就很可能产生严重的安全问题。

所以浏览器为了安全，在一个网站访问另一个网站的服务时，浏览器根据响应头的Access-Control-Allow-Origin字段来验证该域名有没有访问权限，只要发现它们来自不同的域名，就认为它们是属于不同源的跨域请求，浏览器就不会解析服务器返回的数据，这样不同域名之间的请求就无法获取对方的Cookie等数据信息，从而保证了请求的安全性


## 跨域的需求
随着软件行业的飞速发展，我们的开发的分工越来越细化和微服务的流行，不仅前后端开始分开部署，就连后端也从一个大的服务开始拆分成各种小的服务、当我们的网站和我们的服务端分离开来的时候，也就必然造成了跨域的问题，而这种情况又属于我们的正常需求，而要满足这种需求我们就必然需要寻求一种解决跨域的方案了。




## 通过哪些方式可以解决跨域问题？

### JSON
Jsonp 实现跨域的原理是利用了浏览器在解析 script标签 不受同源策略影响的特点所实现的；

其大体流程如下：

(1)浏览器向跨域的服务器发送请求，并且把回调函数名传给跨域请求的服务。

(2)服务器接收到请求后，生成调用该回调函数的JS代码，然后将这段代码返回给客户端。

(3)浏览器收到这段代码后，发现是一段<javascript>所以不进行跨域拦截，默认执行该JS代码，调用对应名称的回调函数。

### Cors实现跨域资源共享
CORS 实现跨域的原理是 修改header中的 Access-Control-Allow-Origin"

既然浏览器根据"Access-Control-Allow-Origin"判断是否有跨域权限的，那么我们也可以通过在服务端往响应头header中添加"Access-Control-Allow-Origin"，指定允许访问的源来达到跨域请求的效果。

其流程如下：

（1）Cors 在浏览器发出请求的时候会添加一个origin的字段，来标识本次请求来源于那个源（协议 + 域名 + 端口);

（2）服务器通过获取origin字段的值，与服务器设定的可跨域的源进行匹配，匹配成功则响应头header中添加"Access-Control-Allow-Origin";

（3）浏览器通过"Access-Control-Allow-Origin" 来验证是否有访问权限。

CORS与JSONP相比，更为先进、方便和可靠。 JSONP只能实现GET请求，而CORS支持所有类型的HTTP请求。

使用CORS，开发者可以使用普通的XMLHttpRequest发起请求和获得数据，比起JSONP有更好的错误处理。


###  通过后台http访问不同源的服务
跨域是浏览器的限制，那么我们可以不通过浏览器发送请求也可以绕过这个问题，让浏览器访问自己的服务端，然后在自己的服务端用http调用不同源的服务请求，这样也可以实现跨域请求的效果。
